!function(e,t,n){"use strict";n.fn.lazyjson=function(a){var o,i=this,l=null,p=null,r=null,d=["lazyLoad","nextBtn","custom"],s=["prevBtn"],u=null,c=!1,f=!1,g={},v=null,m=300,y=n.extend(!0,{},n.fn.lazyjson.defaults,a);i.init=function(){i.checkOpts(),y.loadOnInit&&i.load(!0),y.pagination.active&&(y.pagination.lazyLoad?n(e).scroll(function(){var t=i.position();n(e).height()+n(e).scrollTop()>t.top+i.height()-m&&(u="lazyLoad",i.load())}):y.pagination.loadOnEvent&&y.pagination.loadOnTarget?n("body").on(y.pagination.loadOnEvent,y.pagination.loadOnTarget,function(e){e.preventDefault(),u="custom",i.load()}):(n(i.parent()).on("click",y.pagination.nextBtn,function(e){e.preventDefault(),u="nextBtn",i.load()}),n(i.parent()).on("click",y.pagination.prevBtn,function(e){e.preventDefault(),u="prevBtn",i.load()})))},i.debug=function(e,n,a){t&&t.log&&y.debug&&e&&n&&a&&t.log({name:e,type:n,data:a})},i.checkOpts=function(){n("#"+y.templatePrefix+n(i).attr("id")).length?(o=n("#"+y.templatePrefix+n(i).attr("id")).clone().removeAttr("id").removeAttr("style"),n("#"+y.templatePrefix+n(i).attr("id")).remove()):i.debug("templateNotFound","error","The template object was not found."),y.loader instanceof jQuery||(y.loader=n(y.loader),y.loader.children("img").attr("src",y.loaderImg)),y.noResults instanceof jQuery||(y.noResults=n(y.noResults).text(y.noResultsText)),y.api.uri||i.debug("invalidApiUri","error","Please provide an API endpoint in options.api.uri ."),y.api.httpMethod&&-1!==n.inArray(y.api.httpMethod,["GET","POST"])||i.debug("invalidHttpMethod","error","Please provide a valid HTTP method.")},i.load=function(e){c||(c=!0,(!y.pagination.appendResults&&"lazyLoad"!==u||-1!==n.inArray(u,["nextBtn","prevBtn"]))&&n(".lazyjson-template",i).remove(),-1!==n.inArray(u,d)&&f===!1?l+=1:-1!==n.inArray(u,s)?l-=1:i.debug("currEvent","error","The event is not defined in pagination settings."),i.debug("currEvent","notice",u),i.loader(!0),g=n.extend(!0,g,n(i).data(),y.api.params),y.pagination.active&&(0>=l&&(l=1),e?(l=1,p=y.pagination.pages*y.pagination.count,r=(l-1)*p):(l=l||1,p=p||y.pagination.count,r=(l-1)*p),y.api.pagination&&(g[y.api.pagesKey]=l,g[y.api.limitKey]=p,g[y.api.offsetKey]=r)),i.debug("pagination","notice",{page:l,count:p,offset:r}),n.ajax({type:y.api.httpMethod.toUpperCase(),url:y.api.uri,data:g,dataType:i.getDataType()}).done(function(t){t&&(v=t,y.pagination.active&&!y.api.pagination&&(v=v.slice(r,r+p)),0===v.length?(f=!0,i.append(y.noResults)):(f=!1,y.noResults.remove(),i.build(v))),e&&(l=y.pagination.pages,p=y.pagination.count)}).fail(function(){}).always(function(){i.loader(!1),setTimeout(function(){c=!1},800),y.afterLoad(v)}))},i.build=function(e){"object"!=typeof e?(i.debug("invalidJSON","error","The response must be a valid JSON object."),"string"==typeof e&&n(i.append("<p>"+e+"</p>"))):n.each(e,function(e,t){var n=o.clone(),a=i.parseObj(n.html(),t);n.html(a).addClass("lazyjson-template").appendTo(i),null!==y.effect&&(n.hide(),setTimeout(function(){"fadeIn"===y.effect?n.fadeIn("fast"):"slideDown"===y.effect&&n.slideDown("fast")},y.delay*e))})},i.parseObj=function(e,t,a){if(a?a+=".":a="","object"==typeof t)n.each(t,function(t,n){if(null===n&&(n=""),"object"==typeof n&&t)e=i.parseObj(e,n,a+t);else{var o=new RegExp("{{"+a+t+"}}","g");e=e.replace(o,n)}});else if("string"==typeof t){var o=new RegExp("{{value}}","g");e=e.replace(o,t)}return e},i.getDataType=function(){var e=document.createElement("a"),t=document.createElement("a");return e.href=document.URL,t.href=y.api.uri,t.hostname!==e.hostname||y.api.forceJSONP?"jsonp":"json"},i.loader=function(e){e?i.append(y.loader):n(y.loader,i).remove()},0!==n(this).length?(i.init(),i.debug("options","notice",y)):i.debug("invalidMainElement","error","The main object "+this+" does not exist.")},n.fn.lazyjson.defaults={loadOnInit:!0,templatePrefix:"template-",loader:'<div id="lj-loader" style="text-align:center;padding:20px;"></div>',loaderImg:null,noResults:'<div id="lj-noresponse" style="text-align:center;padding:20px;"></div>',noResultsText:"No Results Found",delay:50,effect:null,pagination:{active:!1,pages:1,count:10,appendResults:!1,lazyLoad:!1,nextBtn:"a.next",prevBtn:"a.previous",loadOnEvent:null,loadOnTarget:null},api:{uri:null,httpMethod:"GET",forceJSONP:!1,pagination:!1,pagesKey:"page",limitKey:"limit",offsetKey:"offset",params:{}},debug:!1,afterLoad:function(){}}}(window,console,jQuery);